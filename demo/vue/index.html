<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>js sdk集成演示</title>
    <!-- <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
    <script>
      var vConsole = new window.VConsole();
    </script> -->
    <script src="/sdk/5.0.3/AnalysysAgent_JS_SDK.min.js"></script>
    <!-- <script src="./public/sdk/4.5.0/AnalysysAgent_JS_SDK.min.js"></script> -->
    <script>
      // 模拟获取用户信息
      function getUserInfo () {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve({
              name: 'hry',
              age: 18,
              phone: 18888888888
            })
          }, 1000)
        })
      }

      window.AnalysysAgent.init({
        appkey: "47fce41a0472c616", //APPKEY
        uploadURL: 'https://uba-up.analysysdata.com',
        debugMode: 2,
        auto: true,
        // hash: true,
        SDKFileDirectory: '/sdk/5.0.3',
        allowTimeCheck: true,
        autoPageViewDuration: true,
        autoTrack: true,
        visitorConfigURL: 'https://uba-up.analysysdata.com',
        // autoClickBlackList: ['http://127.0.0.1:5173/#/'],
        // pageViewBlackList: ['http://127.0.0.1:5173/#/'],
        autoHeatmap: true,
        sendType: 'post',
        // crossSubdomain: true,
        pageProperty: {
          'add': 12333
        },
        // userClickProperty: {
        //   'isClickEle': true
        // }

        // 自定义事件上报之前钩子，返回false则终止上报，可以通过setAttrs设置属性
        beforeTrack (res, setAttrs) {
          
        },

        // 页面浏览上报之前钩子，返回false则终止上报，可以通过setAttrs设置属性
        beforePageView (res, setAttrs) {
          
        },

        // 页面关闭上报之前钩子，返回false则终止上报，可以通过setAttrs设置属性
        beforePageClose (res, setAttrs) {
          
        },

        // sdk初始化完成之前钩子，支持执行异步逻辑，执行完通过next()完成执行，也可以返回一个Promise任务
        async beforeInit (config, next) {

          const userInfo = await getUserInfo()
          this.alias(userInfo.name)

          // return getUserInfo().then((userInfo) => {
          //   this.alias(userInfo.name)
          // })

          // getUserInfo().then((userInfo) => {
          //   this.alias(userInfo.name)
          //   next()
          // })
        }
      })
      
    </script>
    
    <!-- <script>

      (function (config) {
        if (window.AnalysysAgent && window.AnalysysAgent.isInit) return
        window.AnalysysAgent = window.AnalysysAgent || {}
        var ans = ['identify', 'alias', 'reset', 'track', 'profileSet', 'profileSetOnce', 'profileIncrement', 'profileAppend', 'profileUnset', 'profileDelete', 'registerSuperProperty', 'registerSuperProperties', 'unRegisterSuperProperty', 'clearSuperProperties', 'getSuperProperty', 'getSuperProperties', 'pageView', 'getDistinctId']
        var a = window.AnalysysAgent
        a['param'] = []
        function factory (b) {
          return function () {
            a['param'].push({
              fn: b,
              arg: arguments
            })
          }
        }
        for (var i = 0; i < ans.length; i++) {
          a[ans[i]] = factory(ans[i])
        }

        if (config.name) {
          window[config.name] = a
        }
    
        var c = document.createElement('script'), 
            n = document.getElementsByTagName('script')[0];
        c.type = 'text/javascript';
        c.async = true;
        c.id = 'ARK_SDK';
        c.src = './public/sdk/AnalysysAgent_JS_SDK.min.js' + '?v=' + (+new Date());
        c.onload = function () {
          window.AnalysysAgent.init(config)
        }
        n.parentNode.insertBefore(c, n);
      })({
        appkey: "3fd82ebe10ec6437",
        debugMode: 2,
        uploadURL: 'https://yaodandan-up.analysysdata.com/',
        visitorConfigURL: 'https://yaodandan-up.analysysdata.com/',
        autoHeatmap: true
      })
    </script> -->

    <script>
      // window.AnalysysAgent.profileAppend('username', 'asdfadsdf')
      // window.AnalysysAgent.getDistinctId((v)=> {
      //   console.log(v)
      // })
      // window.AnalysysAgent.getSuperProperties((v) => {
      //   console.log(v)
      // })
      // window.AnalysysAgent.getPresetProperties((v) => {
      //   console.log(v)
      // })
    </script>

  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
