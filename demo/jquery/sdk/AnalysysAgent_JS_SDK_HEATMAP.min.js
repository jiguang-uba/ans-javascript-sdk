(function () {
  'use strict';

  function styleInject(css, ref) {
    if ( ref === void 0 ) ref = {};
    var insertAt = ref.insertAt;

    if (!css || typeof document === 'undefined') { return; }

    var head = document.head || document.getElementsByTagName('head')[0];
    var style = document.createElement('style');
    style.type = 'text/css';

    if (insertAt === 'top') {
      if (head.firstChild) {
        head.insertBefore(style, head.firstChild);
      } else {
        head.appendChild(style);
      }
    } else {
      head.appendChild(style);
    }

    if (style.styleSheet) {
      style.styleSheet.cssText = css;
    } else {
      style.appendChild(document.createTextNode(css));
    }
  }

  var css_248z = ".ark-heatmap-location {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 10000; }\n\n.ark-headmap-body-location-none .ark-heatmap-location {\n  display: none; }\n";
  styleInject(css_248z);

  var typeMap = {};
  var typeArr = ['Boolean', 'Number', 'String', 'Function', 'Array', 'Date', 'RegExp', 'Object', 'Error', 'HTMLCollection'];
  typeArr.map(function (item) {
      typeMap["[object " + item + "]"] = item.toLowerCase();
  });
  function type(value) {
      var typeName = typeof value;
      if (typeName === 'object') {
          return typeMap[Object.prototype.toString.call(value)];
      }
      return typeName;
  }
  function isString(value) {
      return type(value) === 'string';
  }
  function isObject(value) {
      return type(value) === 'object';
  }

  function createElement(tag, attrs, el) {
      if (attrs === void 0) {
          attrs = {};
      }
      var node = document.createElement(tag);
      if (attrs.id) {
          node.id = attrs.id;
      }
      if (attrs.class) {
          node.className = attrs.class;
      }
      if (attrs.style && isObject(attrs.style)) {
          for (var key in attrs.style) {
              node.style[key] = attrs.style[key];
          }
      }
      if (attrs.content) {
          node.innerHTML = attrs.content;
      }
      var ele = el ? el : document.querySelector('body');
      ele.appendChild(node);
      return node;
  }
  // 根据元素路径获取dom
  function getPathEle(path) {
      var pathList = parserDom(path);
      if (pathList.length) {
          var eleStr = '';
          for (var i = pathList.length - 3; i >= 0; i--) {
              var item = pathList[i];
              if (item.elePath.indexOf('#') > -1) {
                  eleStr += item.elePath;
              } else {
                  eleStr += item.elePath + ":nth-child(" + (item.index - 0 + 1) + ")";
              }
              if (i > 0) {
                  eleStr += ' > ';
              }
          }
          var ele = eleStr ? document.querySelector(eleStr) : null;
          return ele;
      }
  }
  /**
   * [parserDom description]
   * @param  {[type]} path [description]
   * @return {[type]}      [description]
   */
  function parserDom(path) {
      var eleList = [];
      if (path.indexOf('<') < 0) {
          return [{
              elePath: path.split('|')[0],
              index: path.split('|')[1]
          }];
      }
      var pathObj = path.split('<');
      for (var i = 0; i < pathObj.length; i++) {
          var elelPath = pathObj[i].split('|')[0];
          var eleIndex = pathObj[i].split('|')[1];
          eleList.push({
              elePath: elelPath,
              index: eleIndex
          });
      }
      return eleList;
  }
  /**
   * [parserDom description]根据元素及其上层元素获取元素位置及显示/隐藏
   * @param  {[type]} ele [description] 元素Dom对象
   * @return {[type]} obj [description] 元素对应位置与显示/隐藏
   */
  function getEleOffset(ele) {
      var realTop = 0;
      var realLeft = 0;
      var elemHidden = false;
      var isFixed = false;
      while (ele) {
          if (ele.offsetTop === undefined) {
              ele = ele.parentNode;
              continue;
          }
          realTop += ele.offsetTop;
          realLeft += ele.offsetLeft;
          if (!elemHidden) {
              elemHidden = !!(eleCss(ele, 'display') === 'none' || eleCss(ele, 'width') === '0px' || eleCss(ele, 'height') === '0px');
          }
          if (eleCss(ele, 'position') === 'fixed') {
              isFixed = true;
          }
          ele = ele.offsetParent;
      }
      if (isFixed === true) {
          realTop += document.documentElement.scrollTop || document.body.scrollTop;
          realLeft += document.documentElement.scrollLeft || document.body.scrollLeft;
      }
      return {
          top: realTop,
          left: realLeft,
          hidden: elemHidden
      };
  }
  /**
   * [eleCss description]根据元素对应css列表获取对应属性
   * @param  {[type]} element  [description]元素dom
   * @param  {[type]} property [description]css名称
   * @return {[type]} value [description]css名称对应值
   */
  function eleCss(element, property) {
      var len1, prop, props, q;
      if (!element) {
          return;
      }
      if (typeof property === 'string') {
          return getConstantStyle(element, property);
      } else if (Array.isArray(property)) {
          props = {};
          for (q = 0, len1 = property.length; q < len1; q++) {
              prop = property[q];
              props[prop] = getConstantStyle(element, prop);
          }
          return props;
      }
  }
  /**
   * [getConstantStyle description] 返回元素对应的样式值
   * @param  {[type]} el     [description] 元素
   * @param  {[type]} pelStr [description] 样式名称
   * @return {[type]}        [description]
   */
  function getConstantStyle(el, pelStr) {
      var w = document.defaultView;
      if (w && w.getComputedStyle) {
          return document.defaultView.getComputedStyle(el, null)[pelStr];
      } else {
          return el.currentStyle[pelStr];
      }
  }

  var globalWindow = window;

  function CheckChinese(val) {
      var reg = new RegExp('[\\u4E00-\\u9FFF]+', 'g');
      if (reg.test(val)) {
          return true;
      }
      return false;
  }
  function getUrlParam(paraName) {
      var url = document.location.toString();
      var wName = window.name;
      if (isString(wName) && wName.indexOf(paraName) > -1) {
          url = wName;
      }
      var arrObj = url.split('?');
      if (arrObj.length > 1) {
          var arrPara = []; // arrObj[1].split("&")
          for (var i = 1; i < arrObj.length; i++) {
              arrPara.push.apply(arrPara, arrObj[i].split('&'));
          }
          var arr = void 0;
          for (var index = 0; index < arrPara.length; index++) {
              arr = arrPara[index].split('=');
              if (arr != null && arr[0] === paraName) {
                  var value = arr[1];
                  if (arr[1].indexOf('#') > -1) {
                      value = value.split('#')[0];
                  }
                  if (value.indexOf('%') > -1) {
                      try {
                          var utfValue = decodeURI(value);
                          if (CheckChinese(utfValue)) {
                              return utfValue;
                          }
                      } catch (e) {}
                      if (globalWindow.AnalysysModule && globalWindow.AnalysysModule.decodeGBK) {
                          try {
                              var gbkValue = globalWindow.AnalysysModule.decodeGBK(value, 'gbk');
                              return gbkValue;
                          } catch (e) {}
                      }
                  }
                  return value;
              }
          }
          return '';
      } else {
          return '';
      }
  }

  // 类型转换
  /**
   * json转换为串行字符串
   * @param value
   */
  function jsonToString(value) {
      var strArr = [];
      for (var key in value) {
          var newValue = value[key];
          if (isString(newValue)) {
              newValue = encodeURIComponent(value[key]);
          } else if (isObject(newValue)) {
              newValue = encodeURIComponent(JSON.stringify(value[key]));
          }
          strArr.push(key + '=' + newValue);
      }
      return strArr.join('&');
  }
  /**
   * headers字符串转json
   */
  function headersToJson(headers) {
      var arr = headers.trim().split(/[\r\n]+/);
      var headerMap = {};
      arr.forEach(function (line) {
          var parts = line.split(': ');
          var header = parts.shift();
          var value = parts.join(': ');
          headerMap[header] = value;
      });
      return headerMap;
  }

  // uba传递过来的查询条件
  var arkcontent = null;
  var arkcontentText = {
      crowds: '',
      filter: {
          conditions: [],
          relation: '且'
      }
  };
  // 设置参数
  function setArkcontent(content) {
      arkcontent = content;
  }
  // 查询参数
  var queryParameters = function () {
      var query = {
          content: JSON.stringify(arkcontent),
          times: +new Date()
      };
      return jsonToString(query);
  };
  function getUrlArkcontentText() {
      var contentText = unescape(getUrlParam('arkcontentText'));
      if (contentText) {
          try {
              arkcontentText = JSON.parse(contentText);
              console.log(arkcontentText);
          } catch (e) {}
      }
  }
  // 获取url上面的arkcontent
  function getUrlArkcontent() {
      var content = unescape(getUrlParam('arkcontent'));
      if (content) {
          try {
              arkcontent = JSON.parse(content);
          } catch (e) {}
      }
  }

  var heatConfig = {
      // 当下展示热图类型 Location Element lines
      heatMapType: 'location',
      // 热图是否显示
      heatMapShow: true,
      // 是否打开
      isOpen: true,
      // 帮助文档
      helpDoc: '',
      loading: false,
      nodata: false,
      max: 10
  };
  // 显示配置
  var displayConfig = {
      // 显示深度线
      lineShow: false,
      // 颜色范围
      colorRange: '',
      max: 100,
      min: 0,
      // 背景透明度
      backgroundTransparent: 0.3
  };
  // 初始化
  function storeInit() {
      getUrlArkcontent();
  }

  /**
   * 对象浅拷贝
   *
   */
  function assign(target) {
      var args = [];
      for (var _i = 1; _i < arguments.length; _i++) {
          args[_i - 1] = arguments[_i];
      }
      for (var i = 0; i < args.length; i++) {
          var item = args[i];
          if (isObject(item)) {
              for (var key in item) {
                  target[key] = item[key];
              }
          }
      }
      return target;
  }

  function ajax (options, successFn, errorFn) {
      var xhr = new window.XMLHttpRequest() || new window.ActiveXObject('Microsoft.XMLHTTP') || new window.ActiveXObject('Msxml2.XMLHTTP');
      var method = (options.method || 'GET').toUpperCase();
      var url = options.url;
      var data = options.data;
      var header = assign({}, options.header);
      if (method === 'GET' && options.data) {
          var link = /\?/.test(options.url) ? '&' : '?';
          url += link + jsonToString(options.data);
      }
      if (method === 'POST' && options.data && !header['Content-Type']) {
          data = JSON.stringify(options.data);
      }
      // 建立连接
      xhr.open(method, url);
      // 设置请求头
      for (var key in header) {
          xhr.setRequestHeader(key, header[key]);
      }
      xhr.timeout = options.timeout;
      xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
              if (xhr.status === 200) {
                  var res = {
                      header: headersToJson(xhr.getAllResponseHeaders()),
                      data: xhr.responseText
                  };
                  try {
                      res.data = JSON.parse(xhr.responseText);
                  } catch (err) {}
                  successFn && successFn(res, xhr);
                  options.success && options.success(res, xhr);
              } else {
                  errorFn && errorFn(xhr);
                  options.error && options.error(xhr);
              }
          }
      };
      // 发送数据
      xhr.send(data);
  }

  var css_248z$1 = ".ark-headmap-loading, .ark-headmap-nodata {\n  position: fixed;\n  top: 0;\n  right: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(255, 255, 255, 0.5);\n  text-align: center;\n  z-index: 10000;\n  display: none; }\n  .ark-headmap-loading .ark-loading-box, .ark-headmap-nodata .ark-loading-box {\n    width: 260px;\n    height: 182px;\n    margin: 0 auto;\n    top: 50%;\n    margin-top: -91px;\n    position: relative;\n    background-color: rgba(0, 0, 0, 0.8);\n    border-radius: 4px; }\n    .ark-headmap-loading .ark-loading-box .ark-loading-img, .ark-headmap-nodata .ark-loading-box .ark-loading-img {\n      width: 64px;\n      height: 64px;\n      margin: 0 auto;\n      top: 40px;\n      position: relative;\n      background: url(data:image/png;base64,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) no-repeat;\n      background-size: 100% 100%;\n      animation: ark-around linear 2s infinite; }\n    .ark-headmap-loading .ark-loading-box .ark-loading-text, .ark-headmap-nodata .ark-loading-box .ark-loading-text {\n      padding-top: 65px;\n      color: #fff;\n      font-size: 14px; }\n  .ark-headmap-loading .ark-nodata-box, .ark-headmap-nodata .ark-nodata-box {\n    width: 280px;\n    height: 200px;\n    margin: 0 auto;\n    top: 50%;\n    margin-top: -100px;\n    position: relative; }\n    .ark-headmap-loading .ark-nodata-box .ark-nodata-img, .ark-headmap-nodata .ark-nodata-box .ark-nodata-img {\n      width: 110px;\n      height: 72px;\n      margin: 0 auto;\n      top: 32px;\n      position: relative;\n      background: url(data:image/png;base64,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) no-repeat;\n      background-size: 100% 100%; }\n    .ark-headmap-loading .ark-nodata-box .ark-nodata-text, .ark-headmap-nodata .ark-nodata-box .ark-nodata-text {\n      padding-top: 65px;\n      color: #fff;\n      font-size: 14px; }\n\n.ark-headmap-nodata {\n  background-color: rgba(0, 0, 0, 0.8); }\n\n@keyframes ark-around {\n  0% {\n    -webkit-transform: rotate(0deg);\n    -ms-transform: rotate(0deg);\n    transform: rotate(0deg); }\n  100% {\n    -webkit-transform: rotate(360deg);\n    -ms-transform: rotate(360deg);\n    transform: rotate(360deg); } }\n";
  styleInject(css_248z$1);

  var html = "\n<div class=\"ark-loading-box\">\n    <div class=\"ark-loading-img\"></div>\n    <div class=\"ark-loading-text\">\u751F\u6210\u70ED\u56FE\u4E2D\u2026</div>\n</div>\n";
  function loading () {
      createElement('div', {
          id: 'arkHeadmapLoading',
          class: 'ark-headmap-loading',
          content: html
      }, document.getElementById('arkHeadmapBody'));
  }
  // 显示或隐藏
  function loadingDisply() {
      var loading = document.getElementById('arkHeadmapLoading');
      loading.style.display = heatConfig.loading ? 'block' : 'none';
  }

  var html$1 = "\n<div class=\"ark-nodata-box\">\n    <div class=\"ark-nodata-img\"></div>\n    <div class=\"ark-nodata-text\"></div>\n</div>\n";
  function tips () {
      createElement('div', {
          id: 'arkHeadmapNodata',
          class: 'ark-headmap-nodata',
          content: html$1
      }, document.getElementById('arkHeadmapBody'));
  }
  // 显示或隐藏
  function nodataDisply(nodataText) {
      var nodata = document.getElementById('arkHeadmapNodata');
      nodata.style.display = heatConfig.nodata ? 'block' : 'none';
      setNodataText(nodataText);
  }
  // 设置文案
  function setNodataText(text) {
      document.getElementById('arkHeadmapNodata').querySelector('.ark-nodata-text').innerHTML = text || '';
  }

  /*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */

  var __assign = function() {
      __assign = Object.assign || function __assign(t) {
          for (var s, i = 1, n = arguments.length; i < n; i++) {
              s = arguments[i];
              for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
          }
          return t;
      };
      return __assign.apply(this, arguments);
  };

  var css_248z$2 = ".ark-heat-click-element {\n  position: absolute;\n  left: 0;\n  top: 0;\n  height: 100%;\n  width: 100%;\n  background-color: #ff0000;\n  color: #fff;\n  text-align: center;\n  font-size: 12px;\n  z-index: 10000;\n  line-height: 22px; }\n  .ark-heat-click-element .ark-heat-click-element-text {\n    display: block;\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    position: absolute;\n    width: 100%;\n    top: 50%;\n    margin-top: -11px;\n    text-align: center; }\n  .ark-heat-click-element:hover .ark-heat-click-element-tips {\n    display: block; }\n  .ark-heat-click-element .ark-heat-click-element-tips {\n    position: absolute;\n    background-color: #252d39;\n    font-size: 12px;\n    display: none;\n    top: 100%;\n    top: calc(100% + 5px);\n    font-size: 14px;\n    padding: 10px 0;\n    border-radius: 4px;\n    left: 50%;\n    transform: translate(-50%, 0);\n    white-space: nowrap; }\n    .ark-heat-click-element .ark-heat-click-element-tips::after {\n      content: '';\n      position: absolute;\n      width: 0;\n      height: 0;\n      border-color: transparent;\n      border-style: solid;\n      top: 5px;\n      left: 50%;\n      margin-top: -10px;\n      border-width: 0 7px 5px;\n      border-bottom-color: #252d39;\n      margin-left: -7px; }\n    .ark-heat-click-element .ark-heat-click-element-tips .ark-click-num, .ark-heat-click-element .ark-heat-click-element-tips .ark-click-percent {\n      display: inline-block;\n      text-align: right;\n      padding: 0 10px; }\n      .ark-heat-click-element .ark-heat-click-element-tips .ark-click-num label, .ark-heat-click-element .ark-heat-click-element-tips .ark-click-percent label {\n        display: block;\n        color: #9cacbf; }\n\n.ark-headmap-body-element-none .ark-heat-click-element {\n  display: none; }\n";
  styleInject(css_248z$2);

  var css_248z$3 = ".ark-heatmap-head {\n  position: fixed;\n  left: 0;\n  top: 0;\n  background-color: rgba(0, 0, 0, 0.8);\n  z-index: 10001;\n  width: 100%;\n  height: 64px;\n  font-size: 16px;\n  color: #9cacbf;\n  transition: all 0.3s; }\n  .ark-heatmap-head .ark-icon {\n    display: inline-block;\n    background-size: 100% 100%;\n    width: 14px;\n    height: 14px;\n    margin-right: 10px; }\n    .ark-heatmap-head .ark-icon.ark-icon-point {\n      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAQFJREFUOBGlUjEKwlAMTVR0cRGsQ1HP4QFcPIfgZl28gINDi4t2EzyHV/AcrXQRdNBFUWPTNiWUFsV+KC8vfXk/PwSg5MFf68110H/cnzskHBDSod6ojYOZ6VXEoOP4i7btnRklp5GLgWBIQE3GiIeC1OBNNA15K0FdG8V8s04KTw0qiG4ouCSotVHMbeuk8NIzyDUwVv6IXrDlG7EKk9O8t9e36zh9gk7GxdQFoK4Y6f86zjXQgm9xrgG3HTZ/5C+Oi21yZ5CVFy0R66IODMdbGrZ/ZcwWMy9aIv4XP4HQijcMLU5mjyyN5DVPZkAuAt4AaSMijbI0ktO89AzE9G/8AFToh10DAaI4AAAAAElFTkSuQmCC) no-repeat; }\n    .ark-heatmap-head .ark-icon.ark-icon-ele {\n      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAQZJREFUOBGtUsEOwUAQnZn4AKTc9A8dERJt1IkmDuoLy0ka9QW7ZpZlrUUqNml23ryZ2bdvC/CP1V8dsmhd1lFezkPzJC98f71f+DxKQkjQ0PbJAK6rSdx18y0DEDY8ICPE7DgepG6BxHKy0jpBotzn7jhalfoOAsE7ngK1H1O+H9crfGx5kEaFumIFeshR2kgBG4hAkMiIJz+MLPYg9ExSLHk53T6z60ezZ0Q4V+O4IwOMGh5urkCaCmBS5FlCdvux3BnX1gS4FUVflysxVOzyLyb28sNUmux9/QE2b3fjgVvE00+MO24uGN/8ePkPCGinUA3Zk001ipd+syjUSo3Yj8LnfsIXR3J0GEi1vfgAAAAASUVORK5CYII=) no-repeat; }\n    .ark-heatmap-head .ark-icon.ark-icon-dep {\n      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsSAAALEgHS3X78AAAA10lEQVQ4y63SsU3DQBjF8Z9RBqBxaYkN7JoGMwEMgBRGSOWatK7cUgEbsEGSDZKGOpJLN9ngaA5EEfsima+6+77TvXf/e1kIwZy6MrMWkLf9HuXImcPQFFXKQTkhUiYdpCpv+7OghqbIsrkQFxeoV+hw96f9gdXQFKcshDAG8YBnbOP+HV+4xTLO6ymIJV7iusYer/HC+zhfpXLwEJVPeMMa3dAUW+xQT0LM2/4zqt/gMbKocY0N1ikHP084osJT5LKJDLoxiL/pu/QXwrmQzMrBWPr+PYnfX8xTYCBLOCIAAAAASUVORK5CYII=) no-repeat; }\n    .ark-heatmap-head .ark-icon.ark-icon-element {\n      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAMlJREFUOBFjYBhowAhywP///9uBlD4QhzAyMn4D8s2AbGEgxgdeAdWeZQQqBhnyEohFgdgAKHgRKHYKyJYAYnzgPlCtPVgBUIMhEPvjU01bOaDtLEDMT44tsEA8B9SsDsQaQH89BhrWBGSLETDwCVBtCwtU0T8g/R+KQUJ/oBjExgVAaiAAaCMzEPPC+PSngbabAHEwOTbDEtIroGYRIDYEBswFoGGgQCUmIVmzADUA1f+fAdQASso3gRgEUoFYCMzCTbzGLUVPGQAuSE4Qo6rhyQAAAABJRU5ErkJggg==) no-repeat; }\n    .ark-heatmap-head .ark-icon.ark-icon-content {\n      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAALRJREFUOBFjYKAQMML0////XxfI9gdiFpgYDvoPUHwTIyPjJRR5oAE3gZhY8ACmmQnGANLXkNiEmBcwFACt5gTiHUQ44TRQDS+GASABoAQbEK/HY8hVoJwwVs0wQaACFiBeisWQe0AxKZg6vDRQIRMQL0Ay5BWQrYRXE7okUIMPkgEH0OVhfORYgImRRA9uA44B/XKXkH9wegGY1t8BNTsD8WMg/k/IIJzyoOgDYk+cCiiVAABBtddgMn4BogAAAABJRU5ErkJggg==) no-repeat; }\n    .ark-heatmap-head .ark-icon.ark-icon-set {\n      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAURJREFUOBG1kz9LglEUh71WaGM55OrSB3DtE1RLFg3qUpOOgbhE3yHdCmqJPkIE0WpETurWpksQbTWEUb09v/vea68IKoIHHs655/zuee+/NxabhwVBsAJd8NYjWJ34LUSLEuE33cwivuDibVezmpFmiHLwDQ/wBG9eRPwKTVDtB/Z8Le66LuPrcAsvsAA58LZLYEC1G6jRRHNCY1CBD0hHcgeMHx2HkfwauXeoKmdXgE9CAnZAZ5DHXUIH2nBBroCXSeP1NqEJBk5BloI7uA6rtuEV43vQ7cjqoC0NVuC1s3m6HcMXlNUBnwed9jmcudhugbgEfTgZfI3BzIdo90EDXckztKAPGTgyxjTwWtEGrgY9WIIsrFP/xIeGSA9Jy570kH7R7Pt5Q57CuKe8JTGa/wc0NDsyQKTr6oK36X6mSI+pwz+2s2sE4j6K/AAAAABJRU5ErkJggg==) no-repeat; }\n    .ark-heatmap-head .ark-icon.ark-icon-refresh {\n      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAQ1JREFUOBG1ks8KAVEUxmckFijkAWztZqMsLJQsPIc8hLLyIKws5Dk8AClZsLFkIRZIGb8zXN07l/wpt36dc77vu3eaO+M4/1y+76cg8dUz2BCHDqxgDXNYQuvtQYQKMIMu5NUG+iR4an5aCcRgAo2ngbuIX4G0lUFsw9AyNAE/BzvYQlWzHAdhCjVDDA34JRjACDKGjXCwRCNxG8ikYaOsiGqoe7ho86vWxXh82uAATkwijqFPX361864XqQsjwya5WbkYuaCcYYYG/CG0Q3JwifJuFcvQBPwGyKeOabLdEvBAXitY9HmQn0t+soLSpUb1Qevr9E3CZ2oWjtADz3XdE/WzxQEJSH2W/jF1BQYvzfgwrEoEAAAAAElFTkSuQmCC) no-repeat; }\n    .ark-heatmap-head .ark-icon.ark-icon-help {\n      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAWdJREFUOBGNk79Kw1AUhxuX0qGLjo5SXEyXgiK1dFBcXNRdV7fiWwgurVudVPoAxReQPIOTUAc76SAUg7goxO8XcpPjjUovfLnn/M6f5ObeW6l4I0mSEPpwD3GGbGmhl164BKswhE8YwSGo2RrswxUoppxqUYklASJ4hM6PoHGItWECyi2a4KiriusuH3s90y+ZN41ex1fuMNUwmqBPy9+M3YUPuIFzeIdd06SDr5ow4DEgsBgEwbFJuMWeovWkkXPG1MTfk6+BNmJ6XeCxA2Ow4w7nwggz7C/jy1TNtjppq/7cHmIteIN8CapWDcT/NiBhGV7gVEV2oKUNtIQpNGzQ2CfYEWvXf/LHCsKT+4lLJB35GbxlFS0m9vxL7BptpiWUttElE3uALee7Ga0N6TamGk7pICmAvgE1V5hpOkgT1eQ6zrxHWQdIpzBSTd4g6+xfpgOS9KeFbF0wfXb5MtlOJKhg7uv8DahvoK6C+lwsAAAAAElFTkSuQmCC) no-repeat; }\n    .ark-heatmap-head .ark-icon.ark-icon-down {\n      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAALpJREFUOBFjYBi+4P///1xAvAGIY0n2JVCTIBAfBeJNQPwEiIuINgSoWBqIrwDxJCBmAmI5IL4GxB0EDQEqUgPi+0BciawYyAe56BAQzwViZmQ5OBsoYQLEz4A4ESQIpFHCAMhnB+JVQAwKFw64RhgDKukN1Yw1DIBqGIG4D4jDYfowaKAkLAwmA9lkhcEDoMYqZJOBfKLD4DlQcRKyZhgbKE4wDHYBFfnCNGCjgfK4wwAoyYRN0+AXAwDWDeuTwsPrDwAAAABJRU5ErkJggg==) no-repeat; }\n    .ark-heatmap-head .ark-icon.ark-icon-crowd {\n      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAATtJREFUOBHVUbFKA0EQnd0cKCh+gaKVX5BKbSwsRBIJyGGpgViJiLGxS2Vjgm0IKFHs0iWCoHX+wyJ/kEbU2+fMrnts7oK2OrA3b2bnzc2bJfr3prIKStX6NkAdyStFR4Pb1lO2JoyjMBBsycCixaSk0ZLg8kF9S3y/23oR70178JMvVc9PDeFZjuCwNtdAxubZR3Is5moYFD0pxJLLSfjWbMf2pCii6+ST1iUuMPZ58ekSK7Wz1eRDnYCwo7S+k0sYcwjSx4/d5kDiaWYbsK4YMPcEmkmLWEKB1B7rXuPNxtzoUmmscE3M/+3NLs+3e43Gu5MANCfI3EVrvW9McsGvsuuamgcyNAdWwbNtvL2ONzlfsUsEMKFZCP2bqyGTy45svwuO7DIs1TbOvUJAEJjuKJP/7W5K+Z9NfQHcMWh6c1UmgAAAAABJRU5ErkJggg==) no-repeat; }\n  .ark-heatmap-head .ark-heatmap-switch {\n    display: inline-block;\n    width: 36px;\n    height: 18px;\n    border-radius: 9px;\n    position: relative;\n    background-color: #4c6072;\n    cursor: pointer;\n    vertical-align: sub;\n    margin-right: 5px; }\n    .ark-heatmap-head .ark-heatmap-switch.ark-switch-act {\n      background-color: #0095e3; }\n      .ark-heatmap-head .ark-heatmap-switch.ark-switch-act::before {\n        left: 20px; }\n    .ark-heatmap-head .ark-heatmap-switch::before {\n      content: '';\n      position: absolute;\n      top: 2px;\n      left: 2px;\n      width: 14px;\n      height: 14px;\n      display: inline-block;\n      border-radius: 20px;\n      background-color: #fff;\n      z-index: 20;\n      -webkit-transition: all 0.5s;\n      transition: all 0.5s; }\n  .ark-heatmap-head .ark-head-hide {\n    display: none;\n    position: absolute;\n    width: 64px;\n    height: 32px;\n    line-height: 32px;\n    right: 56px;\n    top: 64px;\n    background-color: rgba(20, 137, 226, 0.8);\n    text-align: center;\n    cursor: pointer; }\n    .ark-heatmap-head .ark-head-hide i {\n      cursor: pointer;\n      margin-right: 0;\n      transform: rotate(180deg); }\n\n.ark-heatmap-head-menu {\n  float: left;\n  margin-left: 20px; }\n\n.ark-heatmap-head-menu-item {\n  float: left;\n  line-height: 64px;\n  text-align: center;\n  margin-right: 10px;\n  cursor: pointer;\n  position: relative; }\n  .ark-heatmap-head-menu-item:hover, .ark-heatmap-head-menu-item.ark-active {\n    color: #1489e2; }\n    .ark-heatmap-head-menu-item:hover::after, .ark-heatmap-head-menu-item.ark-active::after {\n      content: '';\n      height: 2px;\n      position: absolute;\n      left: 0;\n      bottom: 0;\n      background-color: #1489e2;\n      width: 100%; }\n  @media (max-width: 880px) {\n    .ark-heatmap-head-menu-item i {\n      margin-left: 10px; }\n    .ark-heatmap-head-menu-item span {\n      display: none; } }\n\n.ark-heatmap-head-handle {\n  float: right;\n  margin-right: 20px; }\n  .ark-heatmap-head-handle .ark-heatmap-head-handle-item {\n    float: left;\n    padding: 0 10px;\n    margin-right: 10px;\n    position: relative;\n    line-height: 64px; }\n    .ark-heatmap-head-handle .ark-heatmap-head-handle-item:hover .ark-handle-hover {\n      color: #fff; }\n    .ark-heatmap-head-handle .ark-heatmap-head-handle-item:hover .ark-pop-box, .ark-heatmap-head-handle .ark-heatmap-head-handle-item:hover .ark-pop-tips {\n      display: inline-block; }\n    .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-handle-hover {\n      cursor: pointer; }\n    .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-icon-box i {\n      cursor: pointer;\n      width: 16px;\n      height: 16px;\n      float: left;\n      margin-top: 23px;\n      opacity: .8; }\n      .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-icon-box i:hover {\n        opacity: 1; }\n    .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-icon-box .ark-pop-tips {\n      top: 50px;\n      left: -5px; }\n    .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-pop-box, .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-pop-tips {\n      display: none;\n      position: absolute;\n      background-color: #fff;\n      padding: 10px;\n      box-shadow: 2px 0px 4px #252d3933;\n      border: 1px solid #D8E0E9;\n      border-radius: 4px;\n      top: 64px;\n      left: -100px;\n      line-height: 12px;\n      font-size: 12px;\n      color: #333; }\n      .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-pop-box::after, .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-pop-tips::after {\n        content: '';\n        position: absolute;\n        width: 0;\n        height: 0;\n        border-color: transparent;\n        border-style: solid;\n        top: 5px;\n        left: 50%;\n        margin-top: -10px;\n        border-width: 0 7px 5px;\n        border-bottom-color: #fff;\n        margin-left: -7px; }\n    .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-pop-box {\n      padding: 20px; }\n    .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-element-list {\n      width: 500px;\n      left: -200px; }\n      .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-element-list .ark-element-list-hd {\n        font-size: 16px;\n        color: #252d39;\n        padding-bottom: 5px; }\n      .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-element-list .ark-element-list-bd {\n        width: 100%;\n        border-collapse: collapse;\n        border-spacing: 0;\n        text-align: center; }\n        .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-element-list .ark-element-list-bd td {\n          height: 40px;\n          line-height: 40px;\n          font-size: 14px; }\n        .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-element-list .ark-element-list-bd thead td {\n          border-bottom: 2px solid #e4eaf1; }\n        .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-element-list .ark-element-list-bd tbody {\n          max-height: 400px;\n          overflow-y: auto; }\n          .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-element-list .ark-element-list-bd tbody td {\n            border-bottom: 1px solid #e4eaf1;\n            color: #4c6072; }\n          .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-element-list .ark-element-list-bd tbody .ark-element-content {\n            max-width: 150px;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            padding: 0 5px; }\n    .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-filter-condition {\n      width: 300px; }\n      .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-filter-condition .ark-filter-condition-title {\n        color: #6d859e;\n        font-size: 13px; }\n      .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-filter-condition .ark-filter-condition-crowd {\n        padding: 17px 0; }\n        .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-filter-condition .ark-filter-condition-crowd i {\n          margin-right: 5px;\n          vertical-align: bottom; }\n      .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-filter-condition .ark-filter-condition-attrs {\n        position: relative;\n        margin-top: 20px;\n        padding-top: 10px;\n        padding-left: 20px;\n        border-left: solid #e4eaf1 1px; }\n        .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-filter-condition .ark-filter-condition-attrs .ark-condigton-item {\n          padding-bottom: 15px;\n          color: #354359;\n          font-size: 12px; }\n        .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-filter-condition .ark-filter-condition-attrs .ark-condigton-relation {\n          position: absolute;\n          width: 20px;\n          height: 20px;\n          border: solid 1px #c5ced8;\n          border-radius: 10px;\n          font-size: 12px;\n          color: #9cacbf;\n          text-align: center;\n          line-height: 20px;\n          left: -10px;\n          top: 50%;\n          margin-top: -10px;\n          background-color: #fff; }\n    .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-display-set {\n      width: 280px; }\n      .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-display-set .ark-display-set-item {\n        position: relative; }\n        .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-display-set .ark-display-set-item .ark-display-set-item-name {\n          width: 120px;\n          font-size: 14px;\n          position: absolute; }\n        .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-display-set .ark-display-set-item .ark-display-set-item-content {\n          padding-left: 120px; }\n          .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-display-set .ark-display-set-item .ark-display-set-item-content .ark-color-slider-box {\n            position: relative;\n            height: 4px; }\n            .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-display-set .ark-display-set-item .ark-display-set-item-content .ark-color-slider-box .ark-color-left-track {\n              position: absolute;\n              background-color: #9cacbf;\n              height: 100%;\n              left: 0;\n              width: 0px; }\n            .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-display-set .ark-display-set-item .ark-display-set-item-content .ark-color-slider-box .ark-left-trigger {\n              left: 0px; }\n            .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-display-set .ark-display-set-item .ark-display-set-item-content .ark-color-slider-box .ark-color-middle-track {\n              position: absolute;\n              height: 100%;\n              left: 0px;\n              background: linear-gradient(to right, #3023ae 0%, #53a0fd 20%, #b4ec51 41%, #ffa301 81%, #fb0000 100%);\n              right: 0px; }\n            .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-display-set .ark-display-set-item .ark-display-set-item-content .ark-color-slider-box .ark-color-right-track {\n              position: absolute;\n              height: 100%;\n              right: 0;\n              width: 0px;\n              background-color: #fb0000; }\n            .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-display-set .ark-display-set-item .ark-display-set-item-content .ark-color-slider-box .ark-right-trigger {\n              left: calc(100% - 10px); }\n          .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-display-set .ark-display-set-item .ark-display-set-item-content .ark-slider-trigger {\n            z-index: 2;\n            position: absolute;\n            cursor: pointer;\n            width: 10px;\n            height: 10px;\n            top: -4px;\n            background-color: #e4eaf1;\n            border: solid 1px #9cacbf;\n            border-radius: 4px;\n            left: 30%; }\n          .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-display-set .ark-display-set-item .ark-display-set-item-content .ark-slider-box {\n            position: relative;\n            background-color: #9cacbf;\n            border-radius: 2px;\n            height: 4px; }\n            .ark-heatmap-head-handle .ark-heatmap-head-handle-item .ark-display-set .ark-display-set-item .ark-display-set-item-content .ark-slider-box .ark-slider-rate {\n              position: absolute;\n              background-color: #0095e3;\n              left: 0;\n              height: 100%;\n              width: 30%;\n              border-radius: 2px; }\n  @media (max-width: 880px) {\n    .ark-heatmap-head-handle {\n      margin-right: 0; }\n      .ark-heatmap-head-handle #arkHeatmapSwitch, .ark-heatmap-head-handle #arkHotEleList, .ark-heatmap-head-handle #arkHeatDisplayConfig, .ark-heatmap-head-handle #arkConditionList {\n        display: none !important; } }\n";
  styleInject(css_248z$3);

  var html$2 = "\n  <div class=\"ark-heatmap-head-menu\">\n    <div class=\"ark-heatmap-head-menu-item\" id=\"arkNavLocation\" event-agent=\"click\" heat-type=\"location\" controller-name=\"heatmapTab\">\n      <i class=\"ark-icon ark-icon-point\"></i>\n      <span>\u70B9\u51FB\u4F4D\u7F6E\u70ED\u56FE</span>\n    </div>\n    <div class=\"ark-heatmap-head-menu-item\" id=\"arkNavElement\" event-agent=\"click\" heat-type=\"element\" controller-name=\"heatmapTab\">\n      <i class=\"ark-icon ark-icon-ele\"></i>\n      <span>\u70B9\u51FB\u5143\u7D20\u70ED\u56FE</span>\n    </div>\n    <div class=\"ark-heatmap-head-menu-item\" id=\"arkNavLines\" event-agent=\"click\" heat-type=\"lines\" controller-name=\"heatmapTab\">\n      <i class=\"ark-icon ark-icon-dep\"></i>\n      <span>\u6D4F\u89C8\u6DF1\u5EA6\u7EBF</span>\n    </div>\n  </div>\n\n  <div class=\"ark-heatmap-head-handle\">\n    <div class=\"ark-heatmap-head-handle-item\" id=\"arkHotEleList\">\n      <div class=\"ark-handle-hover\"><i class=\"ark-icon ark-icon-element\"></i>\u70ED\u95E8\u5143\u7D20\u5217\u8868</div>\n      <div class=\"ark-pop-box ark-element-list\">\n        <div class=\"ark-element-list-hd\">\u70ED\u95E8\u70B9\u51FB\u5143\u7D20</div>\n        <table class=\"ark-element-list-bd\">\n          <thead>\n            <tr>\n              <td width=\"120\">\u5143\u7D20\u5185\u5BB9</td>\n              <td>\u5143\u7D20\u7C7B\u578B</td>\n              <td>\u7528\u6237\u6570</td>\n              <td>\u70B9\u51FB\u6B21\u6570</td>\n              <td>\u70B9\u51FB\u6B21\u6570\u5360\u6BD4</td>\n            </tr>\n          </thead>\n          <tbody id=\"arkElementList\">\n\n          </tbody>\n        </table>\n      </div>\n    </div>\n    <div class=\"ark-heatmap-head-handle-item\" id=\"arkConditionList\">\n      <div class=\"ark-handle-hover\"><i class=\"ark-icon ark-icon-content\"></i>\u8FC7\u6EE4\u6761\u4EF6</div>\n      <div class=\"ark-pop-box ark-filter-condition\">\n        <div class=\"ark-filter-condition-title\">\u5206\u6790\u7528\u6237\u7FA4</div>\n        <div class=\"ark-filter-condition-crowd\">\n          <i class=\"ark-icon ark-icon-crowd\"></i> <span></span>\n        </div>\n        <div class=\"ark-filter-condition-title\">\u8FC7\u6EE4\u6761\u4EF6</div>\n        <div class=\"ark-filter-condition-attrs\">\n        </div>\n      </div>\n    </div>\n    <div class=\"ark-heatmap-head-handle-item\" id=\"arkHeatDisplayConfig\">\n      <div class=\"ark-handle-hover\"><i class=\"ark-icon ark-icon-set\"></i>\u663E\u793A\u8BBE\u7F6E</div>\n      <div class=\"ark-pop-box ark-display-set\">\n        <div class=\"ark-display-set-item\" >\n          <div class=\"ark-display-set-item-name\" style=\"top:3px\">\u663E\u793A\u6D4F\u89C8\u6DF1\u5EA6\u7EBF</div>\n          <div class=\"ark-display-set-item-content\">\n            <span class=\"ark-heatmap-switch\" id=\"arkDisplayDepth\" event-agent=\"click\" controller-name=\"displayDepth\"></span>\n          </div>\n        </div>\n        <div class=\"ark-display-set-item\" id=\"arkSetColorRange\" style=\"padding-top:20px;\">\n          <div class=\"ark-display-set-item-name\">\u8C03\u6574\u989C\u8272\u8303\u56F4</div>\n          <div class=\"ark-display-set-item-content\" style=\"padding-top:3px\">\n            <div class=\"ark-color-slider-box\" id=\"arkColors\">\n              <div class=\"ark-slider-trigger ark-left-trigger\"></div>\n              <div class=\"ark-slider-trigger ark-right-trigger\"></div>\n              <div class=\"ark-color-left-track\"></div>\n              <div class=\"ark-color-middle-track\"></div>\n              <div class=\"ark-color-right-track\"></div>\n            </div>\n          </div>\n        </div>\n        <div class=\"ark-display-set-item\" id=\"arkSetOpacity\" style=\"padding-top:20px\">\n          <div class=\"ark-display-set-item-name\">\u8C03\u6574\u80CC\u666F\u900F\u660E\u5EA6</div>\n          <div class=\"ark-display-set-item-content\" style=\"padding-top:3px\">\n            <div class=\"ark-slider-box\" id=\"arkOpacitySlider\">\n              <div class=\"ark-slider-rate\"></div>\n              <div class=\"ark-slider-trigger\"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"ark-heatmap-head-handle-item\" id=\"arkHeatmapSwitch\">\n      <span class=\"ark-heatmap-switch\" event-agent=\"click\" controller-name=\"heatmapSwitch\"></span>\u70ED\u56FE\u663E\u793A\n    </div>\n    <div class=\"ark-heatmap-head-handle-item\">\n      <div class=\"ark-icon-box\" event-agent=\"click\" controller-name=\"refresh\">\n        <i class=\"ark-icon ark-icon-refresh\"></i>\n        <div class=\"ark-pop-tips\">\u5237\u65B0</div>\n      </div>\n    </div>\n    <div class=\"ark-heatmap-head-handle-item\">\n      <div class=\"ark-icon-box\">\n        <i class=\"ark-icon ark-icon-help\"></i>\n        <div class=\"ark-pop-tips\">\u5E2E\u52A9</div>\n      </div>\n    </div>\n    <div class=\"ark-heatmap-head-handle-item\">\n      <div class=\"ark-icon-box\" event-agent=\"click\" controller-name=\"navOpen\">\n        <i class=\"ark-icon ark-icon-down\"></i>\n        <div class=\"ark-pop-tips\">\u6536\u8D77</div>\n      </div>\n    </div>\n  </div>\n  <span class=\"ark-head-hide\" event-agent=\"click\" controller-name=\"navOpen\">\n    <i class=\"ark-icon ark-icon-down\"></i>\n  </span>\n";
  function nav () {
      createElement('div', {
          id: 'arkHeatmapHead',
          class: 'ark-heatmap-head',
          content: html$2
      }, document.getElementById('arkHeadmapBody'));
      setSelected();
      heatSwitch();
      toolDisplay();
      opacitySlider();
      renderCondition();
      colorSlider();
  }
  var eleMap = {
      location: 'arkNavLocation',
      element: 'arkNavElement',
      lines: 'arkNavLines'
  };
  // 清空当前选中的菜单
  function emptySelected() {
      var ele = document.getElementById(eleMap[heatConfig.heatMapType]);
      ele.className = 'ark-heatmap-head-menu-item';
  }
  // 选中当前type
  function setSelected() {
      var ele = document.getElementById(eleMap[heatConfig.heatMapType]);
      ele.className = 'ark-heatmap-head-menu-item ark-active';
  }
  // 热图开关
  function heatSwitch() {
      var state = heatConfig.heatMapShow;
      document.getElementById('arkHeatmapSwitch').querySelector('.ark-heatmap-switch').className = state ? 'ark-heatmap-switch ark-switch-act' : 'ark-heatmap-switch';
  }
  function displayDepth() {
      var state = displayConfig.lineShow;
      document.getElementById('arkDisplayDepth').className = state ? 'ark-heatmap-switch ark-switch-act' : 'ark-heatmap-switch';
  }
  // nav open or hide
  function navOpen() {
      document.getElementById('arkHeatmapHead').style.top = heatConfig.isOpen ? '0px' : '-64px';
      document.querySelector('.ark-head-hide').style.display = heatConfig.isOpen ? 'none' : 'block';
  }
  // 工具栏显示与隐藏
  function toolDisplay() {
      var element = document.getElementById('arkHotEleList');
      element.style.display = heatConfig.heatMapType === 'element' ? 'block' : 'none';
      var arkHeatmapSwitch = document.getElementById('arkHeatmapSwitch');
      var arkHeatDisplayConfig = document.getElementById('arkHeatDisplayConfig');
      if (heatConfig.heatMapType !== 'lines') {
          arkHeatmapSwitch.style.display = 'block';
          arkHeatDisplayConfig.style.display = 'block';
      } else {
          arkHeatmapSwitch.style.display = 'none';
          arkHeatDisplayConfig.style.display = 'none';
      }
      if (heatConfig.heatMapType === 'location') {
          document.getElementById('arkSetColorRange').style.display = 'block';
          document.getElementById('arkSetOpacity').style.display = 'block';
      } else {
          document.getElementById('arkSetColorRange').style.display = 'none';
          document.getElementById('arkSetOpacity').style.display = 'none';
      }
  }
  // 条件列表渲染
  function renderCondition() {
      document.querySelector('.ark-filter-condition-crowd span').innerHTML = arkcontentText.crowds;
      // ark-filter-condition-attrs
      var items = '';
      var conditions = arkcontentText.filter.conditions;
      if (conditions.length) {
          conditions.forEach(function (o) {
              items += "<div class=\"ark-condigton-item\">" + o + "</div>";
          });
          if (conditions.length > 1) {
              items += "<span class=\"ark-condigton-relation\">" + arkcontentText.filter.relation + "</span>";
          }
      } else {
          items = '<div class="ark-condigton-item">无<div>';
      }
      document.querySelector('.ark-filter-condition-attrs').innerHTML = items;
  }
  function renderElementList(elementList) {
      var trs = '';
      if (elementList && elementList.length) {
          elementList.forEach(function (o) {
              trs += "\n          <tr>\n            <td><div class=\"ark-element-content\">" + (o.content || '-') + "</div></td>\n            <td>" + o.type + "</td>\n            <td>" + o.uv + "</td>\n            <td>" + o.clickNum + "</td>\n            <td>" + (o.clickNumPercent * 100).toFixed(2) + "%</td>\n          </tr>\n      ";
          });
      }
      document.getElementById('arkElementList').innerHTML = trs;
  }
  // 滑块
  function slider(el, options) {
      this.downX = null;
      this.moveX = null;
      this.max = options.max;
      this.min = options.min;
      var self = this;
      el.addEventListener('mousedown', function (e) {
          self.downX = e.clientX;
          var width = options.trackEl.offsetWidth - 10;
          var left = el.offsetLeft;
          function move(event) {
              if (self.downX) {
                  self.moveX = left + (event.clientX - self.downX);
                  var max = self.max || width;
                  var min = self.min || 0;
                  if (self.moveX > max) {
                      self.moveX = max;
                  }
                  if (self.moveX < min) {
                      self.moveX = min;
                  }
                  options && options.onMove(self.moveX, width);
                  el.style.left = self.moveX + 'px';
              }
          }
          function up() {
              self.downX = null;
              window.removeEventListener('mousemove', move);
              window.removeEventListener('mouseup', up);
              options && options.onUp(self.moveX, width);
          }
          window.addEventListener('mousemove', move);
          window.addEventListener('mouseup', up);
      });
  }
  // 透明度滑块
  function opacitySlider() {
      var arkOpacitySlider = document.getElementById('arkOpacitySlider');
      new slider(arkOpacitySlider.querySelector('.ark-slider-trigger'), {
          trackEl: arkOpacitySlider,
          onMove: function (v) {
              arkOpacitySlider.querySelector('.ark-slider-rate').style.width = v + 'px';
          },
          onUp: function (v, width) {
              displayConfig.backgroundTransparent = v / width;
              setHeatMapConfig();
          }
      });
  }
  // 颜色滑块
  function colorSlider() {
      var arkOpacitySlider = document.getElementById('arkColors');
      var leftSlider = new slider(arkOpacitySlider.querySelector('.ark-left-trigger'), {
          trackEl: arkOpacitySlider,
          onMove: function (v) {
              rightSlider.min = v + 10;
              arkOpacitySlider.querySelector('.ark-color-middle-track').style.left = v + 'px';
              arkOpacitySlider.querySelector('.ark-color-left-track').style.width = v + 'px';
          },
          onUp: function (v, width) {
              displayConfig.min = v / width * 100;
              setHeatMapConfig();
          }
      });
      var rightSlider = new slider(arkOpacitySlider.querySelector('.ark-right-trigger'), {
          trackEl: arkOpacitySlider,
          onMove: function (v, width) {
              leftSlider.max = v - 10;
              var w = width - v;
              arkOpacitySlider.querySelector('.ark-color-middle-track').style.right = w + 'px';
              arkOpacitySlider.querySelector('.ark-color-right-track').style.width = w + 'px';
          },
          onUp: function (v, width) {
              displayConfig.max = v / width * 100;
              setHeatMapConfig();
          }
      });
  }

  var htmlTpl = function (clickNum, clickNumPercent) {
      var percent = (clickNumPercent * 100).toFixed(2);
      return "\n      <span class=\"ark-heat-click-element-text\" data-percent=\"" + percent + "\" data-click-num=\"" + clickNum + "\">" + percent + "%</span>\n      <span class=\"ark-heat-click-element-tips\">\n        <span class=\"ark-click-num\">\n          <label>\u70B9\u51FB\u6570</label>\n          " + clickNum + "\n        </span>\n        <span class=\"ark-click-percent\">\n          <label>\u70B9\u51FB\u5360\u6BD4</label>\n          " + percent + "%\n        </span>\n      </span>\n  ";
  };
  var max = 0;
  var colors = ['63,81,181', '33,150,243', '0,188,212', '87,201,92', '205,220,57', '255,235,59', '255,152,0', '255,87,34', '229,57,53', '183,28,28'];
  function renderElement(data) {
      emptyElement();
      var list = data.detail;
      var elementList = [];
      for (var i = 0; i < list.length; i++) {
          var item = list[i];
          var ele = getPathEle(item.path);
          var targetEle = null;
          if (ele) {
              if (item.clickNum > max) {
                  max = item.clickNum;
              }
              var colorIndex = Math.ceil(item.clickNum / max * 10) - 1;
              var rgba = 'rgba(' + colors[colorIndex] + ',.9)';
              // 改变目标元素
              if (['input', 'img', 'select', 'textarea', 'svg'].indexOf(ele.tagName.toLowerCase()) > -1) {
                  // 备份目标元素
                  targetEle = ele;
                  ele = ele.parentNode;
              }
              var position = eleCss(ele, 'position');
              if (['relative', 'fixed', 'absolute', 'sticky'].indexOf(position) === -1) {
                  ele.style.position = 'relative';
              }
              var positionStyle = {};
              if (targetEle) {
                  positionStyle = {
                      left: targetEle.offsetLeft + 'px',
                      top: targetEle.offsetTop + 'px',
                      width: targetEle.offsetWidth + 'px',
                      height: targetEle.offsetHeight + 'px'
                  };
              }
              createElement('span', {
                  class: 'ark-heat-click-element',
                  content: htmlTpl(item.clickNum, item.clickNumPercent),
                  style: __assign({ backgroundColor: rgba }, positionStyle)
              }, ele);
              elementList.push(item);
          }
      }
      // 渲染点击元素列表
      renderElementList(elementList);
  }
  // 点击元素显示与隐藏
  function elementDisplay() {
      var body = document.querySelector('body');
      var className = body.className;
      if (heatConfig.heatMapShow && heatConfig.heatMapType === 'element') {
          body.className = className.replace(/ ark-headmap-body-element-none/g, '');
      } else {
          if (className.indexOf('ark-headmap-body-element-none') === -1) {
              body.className = className + ' ark-headmap-body-element-none';
          }
      }
  }
  function emptyElement() {
      document.querySelectorAll('.ark-heat-click-element').forEach(function (o) {
          o.remove();
      });
  }

  var renderState = {
      location: false,
      element: false,
      lines: false
  };
  function loading$1(v) {
      heatConfig.loading = v;
      loadingDisply();
  }
  function nodata(v, nodataText) {
      heatConfig.nodata = v;
      nodataDisply(nodataText);
  }
  var nodataTextMap = {
      0: '暂无数据<br/>小舟建议您选择其他时间范围或过滤条件重试',
      1: '查询失败，请联系管理员'
  };
  var heatMapData = null;
  // 获取热图数据
  function getHeatmapData(fn) {
      nodata(false);
      if (renderState[heatConfig.heatMapType] && arkcontent && arkcontent.useCache) {
          return;
      }
      var url = '/ark/sdk/heatmap/click/analysis';
      if (heatConfig.heatMapType === 'element') {
          emptyElement();
          url = '/ark/sdk/heatmap/element/analysis';
      } else {
          emptyHeatmap();
      }
      loading$1(true);
      ajax({
          url: globalWindow.AnalysysAgent.config.uploadURL + url,
          method: 'post',
          data: queryParameters(),
          header: {
              'Content-Type': 'application/x-www-form-urlencoded'
          },
          success: function (_a) {
              var data = _a.data;
              renderState[heatConfig.heatMapType] = false;
              if (data.code === 0) {
                  var datas = data.datas;
                  if (datas && (datas.length && heatConfig.heatMapType === 'location' || datas.detail && datas.detail.length && heatConfig.heatMapType === 'element')) {
                      if (heatConfig.heatMapType === 'location') {
                          heatMapData = datas;
                      }
                      fn && fn(data);
                      renderState[heatConfig.heatMapType] = true;
                  } else {
                      nodata(true, nodataTextMap[0]);
                  }
              } else {
                  nodata(true, data.msg || nodataTextMap[1]);
              }
              loading$1(false);
          },
          error: function () {
              loading$1(false);
              nodata(true);
          }
      });
  }
  var isTypeLines = function (fn) {
      if (heatConfig.heatMapType === 'lines') {
          fn && fn();
      }
  };
  // 获取深度线
  function getLinesData(fn) {
      nodata(false);
      if (renderState.lines && arkcontent && arkcontent.useCache) {
          return;
      }
      isTypeLines(function () {
          loading$1(true);
      });
      ajax({
          url: globalWindow.AnalysysAgent.config.uploadURL + '/ark/sdk/heatmap/scrollreach/analysis',
          method: 'post',
          data: queryParameters(),
          header: {
              'Content-Type': 'application/x-www-form-urlencoded'
          },
          success: function (_a) {
              var data = _a.data;
              renderState.lines = false;
              if (data.code === 0) {
                  if (data.datas && data.datas.detail && data.datas.detail.length) {
                      fn && fn(data);
                      renderState.lines = true;
                  } else {
                      nodata(true, nodataTextMap[0]);
                  }
              } else {
                  isTypeLines(function () {
                      nodata(true, data.msg || nodataTextMap[1]);
                  });
              }
              isTypeLines(function () {
                  loading$1(false);
              });
          },
          error: function () {
              isTypeLines(function () {
                  loading$1(false);
                  nodata(true);
              });
          }
      });
  }

  var commonjsGlobal = typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};

  function createCommonjsModule(fn, module) {
  	return module = { exports: {} }, fn(module, module.exports), module.exports;
  }

  var heatmap = createCommonjsModule(function (module) {
    /*
     * heatmap.js v2.0.5 | JavaScript Heatmap Library
     *
     * Copyright 2008-2016 Patrick Wied <heatmapjs@patrick-wied.at> - All rights reserved.
     * Dual licensed under MIT and Beerware license
     *
     * :: 2016-09-05 01:16
     */
    (function (name, context, factory) {
      // Supports UMD. AMD, CommonJS/Node.js and browser context
      if ( module.exports) {
        module.exports = factory();
      } else {
        context[name] = factory();
      }
    })('h337', commonjsGlobal, function () {
      // Heatmap Config stores default values and will be merged with instance config
      var HeatmapConfig = {
        defaultRadius: 40,
        defaultRenderer: 'canvas2d',
        defaultGradient: { 0.25: 'rgb(0,0,255)', 0.55: 'rgb(0,255,0)', 0.85: 'yellow', 1.0: 'rgb(255,0,0)' },
        defaultMaxOpacity: 1,
        defaultMinOpacity: 0,
        defaultBlur: 0.85,
        defaultXField: 'x',
        defaultYField: 'y',
        defaultValueField: 'value',
        plugins: {}
      };
      var Store = function StoreClosure() {
        var Store = function Store(config) {
          this._coordinator = {};
          this._data = [];
          this._radi = [];
          this._min = 10;
          this._max = 1;
          this._xField = config.xField || config.defaultXField;
          this._yField = config.yField || config.defaultYField;
          this._valueField = config.valueField || config.defaultValueField;

          if (config.radius) {
            this._cfgRadius = config.radius;
          }
        };

        var defaultRadius = HeatmapConfig.defaultRadius;

        Store.prototype = {
          // when forceRender = false -> called from setData, omits renderall event
          _organiseData: function (dataPoint, forceRender) {
            var x = dataPoint[this._xField];
            var y = dataPoint[this._yField];
            var radi = this._radi;
            var store = this._data;
            var max = this._max;
            var min = this._min;
            var value = dataPoint[this._valueField] || 1;
            var radius = dataPoint.radius || this._cfgRadius || defaultRadius;

            if (!store[x]) {
              store[x] = [];
              radi[x] = [];
            }

            if (!store[x][y]) {
              store[x][y] = value;
              radi[x][y] = radius;
            } else {
              store[x][y] += value;
            }
            var storedVal = store[x][y];

            if (storedVal > max) {
              if (!forceRender) {
                this._max = storedVal;
              } else {
                this.setDataMax(storedVal);
              }
              return false;
            } else if (storedVal < min) {
              if (!forceRender) {
                this._min = storedVal;
              } else {
                this.setDataMin(storedVal);
              }
              return false;
            } else {
              return {
                x: x,
                y: y,
                value: value,
                radius: radius,
                min: min,
                max: max
              };
            }
          },
          _unOrganizeData: function () {
            var unorganizedData = [];
            var data = this._data;
            var radi = this._radi;

            for (var x in data) {
              for (var y in data[x]) {
                unorganizedData.push({
                  x: x,
                  y: y,
                  radius: radi[x][y],
                  value: data[x][y]
                });
              }
            }
            return {
              min: this._min,
              max: this._max,
              data: unorganizedData
            };
          },
          _onExtremaChange: function () {
            this._coordinator.emit('extremachange', {
              min: this._min,
              max: this._max
            });
          },
          addData: function () {
            if (arguments[0].length > 0) {
              var dataArr = arguments[0];
              var dataLen = dataArr.length;
              while (dataLen--) {
                this.addData.call(this, dataArr[dataLen]);
              }
            } else {
              // add to store
              var organisedEntry = this._organiseData(arguments[0], true);
              if (organisedEntry) {
                // if it's the first datapoint initialize the extremas with it
                if (this._data.length === 0) {
                  this._min = this._max = organisedEntry.value;
                }
                this._coordinator.emit('renderpartial', {
                  min: this._min,
                  max: this._max,
                  data: [organisedEntry]
                });
              }
            }
            return this;
          },
          setData: function (data) {
            var dataPoints = data.data;
            var pointsLen = dataPoints.length;

            // reset data arrays
            this._data = [];
            this._radi = [];

            for (var i = 0; i < pointsLen; i++) {
              this._organiseData(dataPoints[i], false);
            }
            this._max = data.max;
            this._min = data.min || 0;

            this._onExtremaChange();
            this._coordinator.emit('renderall', this._getInternalData());
            return this;
          },
          removeData: function () {
            // TODO: implement
          },
          setDataMax: function (max) {
            this._max = max;
            this._onExtremaChange();
            this._coordinator.emit('renderall', this._getInternalData());
            return this;
          },
          setDataMin: function (min) {
            this._min = min;
            this._onExtremaChange();
            this._coordinator.emit('renderall', this._getInternalData());
            return this;
          },
          setCoordinator: function (coordinator) {
            this._coordinator = coordinator;
          },
          _getInternalData: function () {
            return {
              max: this._max,
              min: this._min,
              data: this._data,
              radi: this._radi
            };
          },
          getData: function () {
            return this._unOrganizeData();
          } /*,
            TODO: rethink.
            getValueAt: function(point) {
            var value;
            var radius = 100;
            var x = point.x;
            var y = point.y;
            var data = this._data;
            if (data[x] && data[x][y]) {
             return data[x][y];
            } else {
             var values = [];
             // radial search for datapoints based on default radius
             for(var distance = 1; distance < radius; distance++) {
               var neighbors = distance * 2 +1;
               var startX = x - distance;
               var startY = y - distance;
                for(var i = 0; i < neighbors; i++) {
                 for (var o = 0; o < neighbors; o++) {
                   if ((i == 0 || i == neighbors-1) || (o == 0 || o == neighbors-1)) {
                     if (data[startY+i] && data[startY+i][startX+o]) {
                       values.push(data[startY+i][startX+o]);
                     }
                   } else {
                     continue;
                   }
                 }
               }
             }
             if (values.length > 0) {
               return Math.max.apply(Math, values);
             }
            }
            return false;
            } */
        };

        return Store;
      }();

      var Canvas2dRenderer = function Canvas2dRendererClosure() {
        var _getColorPalette = function (config) {
          var gradientConfig = config.gradient || config.defaultGradient;
          var paletteCanvas = document.createElement('canvas');
          var paletteCtx = paletteCanvas.getContext('2d');

          paletteCanvas.width = 256;
          paletteCanvas.height = 1;

          var gradient = paletteCtx.createLinearGradient(0, 0, 256, 1);
          for (var key in gradientConfig) {
            gradient.addColorStop(key, gradientConfig[key]);
          }

          paletteCtx.fillStyle = gradient;
          paletteCtx.fillRect(0, 0, 256, 1);

          return paletteCtx.getImageData(0, 0, 256, 1).data;
        };

        var _getPointTemplate = function (radius, blurFactor) {
          var tplCanvas = document.createElement('canvas');
          var tplCtx = tplCanvas.getContext('2d');
          var x = radius;
          var y = radius;
          tplCanvas.width = tplCanvas.height = radius * 2;

          if (blurFactor == 1) {
            tplCtx.beginPath();
            tplCtx.arc(x, y, radius, 0, 2 * Math.PI, false);
            tplCtx.fillStyle = 'rgba(0,0,0,1)';
            tplCtx.fill();
          } else {
            var gradient = tplCtx.createRadialGradient(x, y, radius * blurFactor, x, y, radius);
            gradient.addColorStop(0, 'rgba(0,0,0,1)');
            gradient.addColorStop(1, 'rgba(0,0,0,0)');
            tplCtx.fillStyle = gradient;
            tplCtx.fillRect(0, 0, 2 * radius, 2 * radius);
          }

          return tplCanvas;
        };

        var _prepareData = function (data) {
          var renderData = [];
          var min = data.min;
          var max = data.max;
          var radi = data.radi;
          data = data.data;

          var xValues = Object.keys(data);
          var xValuesLen = xValues.length;

          while (xValuesLen--) {
            var xValue = xValues[xValuesLen];
            var yValues = Object.keys(data[xValue]);
            var yValuesLen = yValues.length;
            while (yValuesLen--) {
              var yValue = yValues[yValuesLen];
              var value = data[xValue][yValue];
              var radius = radi[xValue][yValue];
              renderData.push({
                x: xValue,
                y: yValue,
                value: value,
                radius: radius
              });
            }
          }

          return {
            min: min,
            max: max,
            data: renderData
          };
        };

        function Canvas2dRenderer(config) {
          var container = config.container;
          var shadowCanvas = this.shadowCanvas = document.createElement('canvas');
          var canvas = this.canvas = config.canvas || document.createElement('canvas');
          this._renderBoundaries = [10000, 10000, 0, 0];

          var computed = getComputedStyle(config.container) || {};

          canvas.className = 'heatmap-canvas';

          this._width = canvas.width = shadowCanvas.width = config.width || +computed.width.replace(/px/, '');
          this._height = canvas.height = shadowCanvas.height = config.height || +computed.height.replace(/px/, '');

          this.shadowCtx = shadowCanvas.getContext('2d');
          this.ctx = canvas.getContext('2d');

          // @TODO:
          // conditional wrapper

          canvas.style.cssText = shadowCanvas.style.cssText = 'position:absolute;left:0;top:0;';

          container.style.position = 'relative';
          container.appendChild(canvas);

          this._palette = _getColorPalette(config);
          this._templates = {};

          this._setStyles(config);
        }

        Canvas2dRenderer.prototype = {
          renderPartial: function (data) {
            if (data.data.length > 0) {
              this._drawAlpha(data);
              this._colorize();
            }
          },
          renderAll: function (data) {
            // reset render boundaries
            this._clear();
            if (data.data.length > 0) {
              this._drawAlpha(_prepareData(data));
              this._colorize();
            }
          },
          _updateGradient: function (config) {
            this._palette = _getColorPalette(config);
          },
          updateConfig: function (config) {
            if (config.gradient) {
              this._updateGradient(config);
            }
            this._setStyles(config);
          },
          setDimensions: function (width, height) {
            this._width = width;
            this._height = height;
            this.canvas.width = this.shadowCanvas.width = width;
            this.canvas.height = this.shadowCanvas.height = height;
          },
          _clear: function () {
            this.shadowCtx.clearRect(0, 0, this._width, this._height);
            this.ctx.clearRect(0, 0, this._width, this._height);
          },
          _setStyles: function (config) {
            this._blur = config.blur == 0 ? 0 : config.blur || config.defaultBlur;

            if (config.backgroundColor) {
              this.canvas.style.backgroundColor = config.backgroundColor;
            }

            this._width = this.canvas.width = this.shadowCanvas.width = config.width || this._width;
            this._height = this.canvas.height = this.shadowCanvas.height = config.height || this._height;

            this._opacity = (config.opacity || 0) * 255;
            this._maxOpacity = (config.maxOpacity || config.defaultMaxOpacity) * 255;
            this._minOpacity = (config.minOpacity || config.defaultMinOpacity) * 255;
            this._useGradientOpacity = !!config.useGradientOpacity;
          },
          _drawAlpha: function (data) {
            var min = this._min = data.min;
            var max = this._max = data.max;
            data = data.data || [];
            var dataLen = data.length;
            // on a point basis?
            var blur = 1 - this._blur;

            while (dataLen--) {
              var point = data[dataLen];

              var x = point.x;
              var y = point.y;
              var radius = point.radius;
              // if value is bigger than max
              // use max as value
              var value = Math.min(point.value, max);
              var rectX = x - radius;
              var rectY = y - radius;
              var shadowCtx = this.shadowCtx;

              var tpl;
              if (!this._templates[radius]) {
                this._templates[radius] = tpl = _getPointTemplate(radius, blur);
              } else {
                tpl = this._templates[radius];
              }
              // value from minimum / value range
              // => [0, 1]
              var templateAlpha = (value - min) / (max - min);
              // this fixes #176: small values are not visible because globalAlpha < .01 cannot be read from imageData
              shadowCtx.globalAlpha = templateAlpha < 0.01 ? 0.01 : templateAlpha;

              shadowCtx.drawImage(tpl, rectX, rectY);

              // update renderBoundaries
              if (rectX < this._renderBoundaries[0]) {
                this._renderBoundaries[0] = rectX;
              }
              if (rectY < this._renderBoundaries[1]) {
                this._renderBoundaries[1] = rectY;
              }
              if (rectX + 2 * radius > this._renderBoundaries[2]) {
                this._renderBoundaries[2] = rectX + 2 * radius;
              }
              if (rectY + 2 * radius > this._renderBoundaries[3]) {
                this._renderBoundaries[3] = rectY + 2 * radius;
              }
            }
          },
          _colorize: function () {
            var x = this._renderBoundaries[0];
            var y = this._renderBoundaries[1];
            var width = this._renderBoundaries[2] - x;
            var height = this._renderBoundaries[3] - y;
            var maxWidth = this._width;
            var maxHeight = this._height;
            var opacity = this._opacity;
            var maxOpacity = this._maxOpacity;
            var minOpacity = this._minOpacity;
            var useGradientOpacity = this._useGradientOpacity;

            if (x < 0) {
              x = 0;
            }
            if (y < 0) {
              y = 0;
            }
            if (x + width > maxWidth) {
              width = maxWidth - x;
            }
            if (y + height > maxHeight) {
              height = maxHeight - y;
            }

            var img = this.shadowCtx.getImageData(x, y, width, height);
            var imgData = img;
            var len = imgData.data.length;
            var palette = this._palette;
            for (var i = 3; i < len; i += 4) {
              var alpha = imgData.data[i];
              var offset = alpha * 4;

              if (!offset) {
                continue;
              }
              var finalAlpha;
              if (opacity > 0) {
                finalAlpha = opacity;
              } else {
                if (alpha < maxOpacity) {
                  if (alpha < minOpacity) {
                    finalAlpha = minOpacity;
                  } else {
                    finalAlpha = alpha;
                  }
                } else {
                  finalAlpha = maxOpacity;
                }
              }

              imgData.data[i - 3] = palette[offset];
              imgData.data[i - 2] = palette[offset + 1];
              imgData.data[i - 1] = palette[offset + 2];
              imgData.data[i] = useGradientOpacity ? palette[offset + 3] : finalAlpha;
            }

            // img.data = imgData;
            this.ctx.putImageData(imgData, x, y);

            this._renderBoundaries = [1000, 1000, 0, 0];
          },
          getValueAt: function (point) {
            var value;
            var shadowCtx = this.shadowCtx;
            var img = shadowCtx.getImageData(point.x, point.y, 1, 1);
            var data = img.data[3];
            var max = this._max;
            var min = this._min;

            value = Math.abs(max - min) * (data / 255) >> 0;

            return value;
          },
          getDataURL: function () {
            return this.canvas.toDataURL();
          }
        };

        return Canvas2dRenderer;
      }();

      var Renderer = function RendererClosure() {
        var rendererFn = false;

        if (HeatmapConfig.defaultRenderer === 'canvas2d') {
          rendererFn = Canvas2dRenderer;
        }

        return rendererFn;
      }();

      var Util = {
        merge: function () {
          var merged = {};
          var argsLen = arguments.length;
          for (var i = 0; i < argsLen; i++) {
            var obj = arguments[i];
            for (var key in obj) {
              merged[key] = obj[key];
            }
          }
          return merged;
        }
        // Heatmap Constructor
      };var Heatmap = function HeatmapClosure() {
        var Coordinator = function CoordinatorClosure() {
          function Coordinator() {
            this.cStore = {};
          }

          Coordinator.prototype = {
            on: function (evtName, callback, scope) {
              var cStore = this.cStore;

              if (!cStore[evtName]) {
                cStore[evtName] = [];
              }
              cStore[evtName].push(function (data) {
                return callback.call(scope, data);
              });
            },
            emit: function (evtName, data) {
              var cStore = this.cStore;
              if (cStore[evtName]) {
                var len = cStore[evtName].length;
                for (var i = 0; i < len; i++) {
                  var callback = cStore[evtName][i];
                  callback(data);
                }
              }
            }
          };

          return Coordinator;
        }();

        var _connect = function (scope) {
          var renderer = scope._renderer;
          var coordinator = scope._coordinator;
          var store = scope._store;

          coordinator.on('renderpartial', renderer.renderPartial, renderer);
          coordinator.on('renderall', renderer.renderAll, renderer);
          coordinator.on('extremachange', function (data) {
            scope._config.onExtremaChange && scope._config.onExtremaChange({
              min: data.min,
              max: data.max,
              gradient: scope._config.gradient || scope._config.defaultGradient
            });
          });
          store.setCoordinator(coordinator);
        };

        function Heatmap() {
          var config = this._config = Util.merge(HeatmapConfig, arguments[0] || {});
          this._coordinator = new Coordinator();
          if (config.plugin) {
            var pluginToLoad = config.plugin;
            if (!HeatmapConfig.plugins[pluginToLoad]) {
              throw new Error('Plugin \'' + pluginToLoad + '\' not found. Maybe it was not registered.');
            } else {
              var plugin = HeatmapConfig.plugins[pluginToLoad];
              // set plugin renderer and store
              this._renderer = new plugin.renderer(config);
              this._store = new plugin.store(config);
            }
          } else {
            this._renderer = new Renderer(config);
            this._store = new Store(config);
          }
          _connect(this);
        }

        // @TODO:
        // add API documentation
        Heatmap.prototype = {
          addData: function () {
            this._store.addData.apply(this._store, arguments);
            return this;
          },
          removeData: function () {
            this._store.removeData && this._store.removeData.apply(this._store, arguments);
            return this;
          },
          setData: function () {
            this._store.setData.apply(this._store, arguments);
            return this;
          },
          setDataMax: function () {
            this._store.setDataMax.apply(this._store, arguments);
            return this;
          },
          setDataMin: function () {
            this._store.setDataMin.apply(this._store, arguments);
            return this;
          },
          configure: function (config) {
            this._config = Util.merge(this._config, config);
            this._renderer.updateConfig(this._config);
            this._coordinator.emit('renderall', this._store._getInternalData());
            return this;
          },
          repaint: function () {
            this._coordinator.emit('renderall', this._store._getInternalData());
            return this;
          },
          getData: function () {
            return this._store.getData();
          },
          getDataURL: function () {
            return this._renderer.getDataURL();
          },
          getValueAt: function (point) {
            if (this._store.getValueAt) {
              return this._store.getValueAt(point);
            } else if (this._renderer.getValueAt) {
              return this._renderer.getValueAt(point);
            } else {
              return null;
            }
          }
        };

        return Heatmap;
      }();

      // core
      var heatmapFactory = {
        create: function (config) {
          return new Heatmap(config);
        },
        register: function (pluginKey, plugin) {
          HeatmapConfig.plugins[pluginKey] = plugin;
        }
      };

      return heatmapFactory;
    });
  });

  function ColorRangeMaker(option) {
    var vRange = option.value[1] - option.value[0];
    if (option.color.length === 2) {
      // 仅有两个颜色
      var rA = (option.color[1][0] - option.color[0][0]) / vRange;
      var gA = (option.color[1][1] - option.color[0][1]) / vRange;
      var bA = (option.color[1][2] - option.color[0][2]) / vRange;
      this.option = {
        vRange: vRange,
        rA: rA,
        gA: gA,
        bA: bA,
        option: option
      };
    } else {
      // 两个以上颜色
      var makers = [];
      var vA = vRange / (option.color.length - 1);
      for (var i = 1; i < option.color.length; i++) {
        var maker = new ColorRangeMaker({
          color: [option.color[i - 1], option.color[i]],
          value: [option.value[0] + vA * (i - 1), option.value[0] + vA * i]
        });
        makers.push(maker);
      }
      this.option = { makers, vA, option };
    }
  }

  ColorRangeMaker.prototype.make = function (value) {
    var makers = this.option.makers;
    var rA = this.option.rA;
    var gA = this.option.gA;
    var bA = this.option.bA;
    var vA = this.option.vA;
    var option = this.option.option;
    if (value < option.value[0]) {
      return option.color[0];
    } else if (value > option.value[option.value.length - 1]) {
      return option.color[option.color.length - 1];
    } else {
      if (option.color.length === 2) {
        // 仅有两个颜色
        var color = option.color[0].map(a => a);
        var vATmp = value - option.value[0];
        color[0] += parseInt(rA * vATmp);
        color[1] += parseInt(gA * vATmp);
        color[2] += parseInt(bA * vATmp);
        return color;
      } else {
        for (var i = 1; i < option.color.length; i++) {
          if (value <= option.value[0] + vA * i) {
            return makers[i - 1].make(value);
          }
        }
      }
    }
  };

  function resetGradient(max, min) {
    var colorRange = new ColorRangeMaker({
      color: [[48, 35, 174], [83, 160, 253], [180, 236, 81], [255, 163, 1], [251, 0, 0]],
      value: [0, 100]
    });
    var rangeArea = [0, 0.2, 0.41, 0.81, 1];
    var color = {};
    var DValue = max - min;
    for (var i = 0; i < rangeArea.length; i++) {
      var colorList = colorRange.make(min + rangeArea[i] * DValue);
      var rgb = 'rgb(' + colorList.join(',') + ')';
      color[rangeArea[i]] = rgb;
    }
    return color;
  }

  var html$3 = "";
  var heatmap$1 = null;
  function heatmap$2 () {
      createElement('div', {
          id: 'arkHeatmapLocation',
          class: 'ark-heatmap-location',
          content: html$3
      }, document.getElementById('arkHeadmapBody'));
      setHeatMapSize();
  }
  // 设置热图容器大小
  function setHeatMapSize() {
      var arkHeatmapLocation = document.getElementById('arkHeatmapLocation');
      var width = document.documentElement.scrollWidth;
      var height = document.documentElement.scrollHeight;
      arkHeatmapLocation.style.width = width + 'px';
      arkHeatmapLocation.style.height = height + 'px';
      var canvas = arkHeatmapLocation.querySelector('canvas');
      if (canvas) {
          canvas.width = width;
          canvas.height = height;
      }
  }
  // 热图展示与隐藏
  function heatmapDisplay() {
      document.getElementById('arkHeatmapLocation').style.display = heatConfig.heatMapShow && heatConfig.heatMapType === 'location' ? 'block' : 'none';
  }
  function emptyHeatmap() {
      document.getElementById('arkHeatmapLocation').style.display = 'none';
  }
  // 渲染热图
  function renderHeatmap(data) {
      heatmapDisplay();
      if (!heatmap$1) {
          heatmap$1 = heatmap.create({
              container: document.getElementById('arkHeatmapLocation'),
              radius: 15,
              gradient: {
                  0: '#3023ae',
                  0.2: '#53a0fd',
                  0.4: '#b4ec51',
                  0.8: '#ffa301',
                  1: '#fb0000'
              },
              backgroundColor: "rgba(0,0,0," + (1 - displayConfig.backgroundTransparent) + ")",
              maxOpacity: 0.65,
              minOpacity: 0.2
          });
      }
      var point = [];
      var pageWidth = document.documentElement.scrollWidth;
      for (var i = 0; i < data.length; i++) {
          var o = data[i];
          var el = getPathEle(o.$element_path);
          if (!el) {
              continue;
          }
          var eleXPostion = getEleOffset(el);
          if (!eleXPostion || eleXPostion.hidden) {
              continue;
          }
          // 比例
          var proportion = pageWidth / o.$page_width;
          point.push({
              x: eleXPostion.left + Math.ceil(o.$element_x * proportion),
              y: eleXPostion.top + o.$element_y,
              value: 1
          });
      }
      heatmap$1.setData({
          min: 0,
          max: 10,
          data: point
      });
  }
  // 修改热图配置
  function setHeatMapConfig() {
      heatmap$1.configure({
          backgroundColor: "rgba(0,0,0," + (1 - displayConfig.backgroundTransparent) + ")",
          gradient: resetGradient(displayConfig.max, displayConfig.min)
      });
  }
  var renderTime = null;
  function resetRenderHeatMap() {
      clearTimeout(renderTime);
      renderTime = setTimeout(function () {
          if (heatMapData) {
              emptyHeatmap();
              setHeatMapSize();
              renderHeatmap(heatMapData);
          }
      }, 200);
  }
  function heatMapResize() {
      window.addEventListener('resize', function () {
          resetRenderHeatMap();
      });
  }
  heatMapResize();

  var css_248z$4 = ".ark-page-line {\n  z-index: 5002;\n  position: absolute;\n  width: 100%;\n  height: 1px;\n  left: 0;\n  border-bottom: dashed 1px #262d39; }\n  .ark-page-line.ark-mouse-lines {\n    border-bottom-style: solid; }\n  .ark-page-line .ark-page-line-value {\n    background-color: #262d39;\n    font-size: 14px;\n    padding: 8px 16px;\n    border-radius: 0 4px 0 0;\n    position: absolute;\n    left: 0;\n    bottom: -1px;\n    color: #fff; }\n  .ark-page-line .ark-page-mouse-line-value {\n    left: 50%;\n    border-radius: 4px 4px 0 0;\n    padding: 8px 0;\n    width: 190px;\n    text-align: center;\n    margin-left: -95px; }\n\n.ark-headmap-body-line-none .ark-page-line {\n  display: none; }\n";
  styleInject(css_248z$4);

  var lineTpl = function (value) {
      return "<div class=\"ark-page-line-value\">" + value + "%</div>";
  };
  var mouseLineTpl = "<div id=\"arkMouseLineValue\" class=\"ark-page-line-value ark-page-mouse-line-value\"></div>";
  // 显示或隐藏深度线
  function displayLines() {
      var body = document.querySelector('body');
      var className = body.className;
      if (displayConfig.lineShow || heatConfig.heatMapType === 'lines') {
          body.className = className.replace(/ ark-headmap-body-line-none/g, '');
      } else {
          if (className.indexOf('ark-headmap-body-line-none') === -1) {
              body.className = className + ' ark-headmap-body-line-none';
          }
      }
  }
  var linesData = null;
  /**
   * 渲染深度线
   */
  function setMouseLine(event) {
      var e = event || window.event;
      var scrollY = document.documentElement.scrollTop || document.body.scrollTop;
      var y = e.pageY || e.clientY + scrollY;
      var num = y;
      var lineNum = Math.floor(num / 10);
      var detail = linesData.detail || [];
      if (detail.length === 0) {
          return;
      }
      var uv = linesData.uv;
      var value = 0;
      if (lineNum < detail.length) {
          value = Math.ceil(detail[lineNum] / uv * 10000) / 100;
      }
      var mouseLineEle = document.getElementById('arkMouseLine');
      if (!mouseLineEle) {
          mouseLineEle = createElement('div', {
              id: 'arkMouseLine',
              class: 'ark-page-line ark-mouse-lines',
              content: mouseLineTpl
          });
      }
      document.getElementById('arkMouseLineValue').innerHTML = value + '% 的人浏览到了这里';
      mouseLineEle.style.top = y + 5 + 'px';
  }
  function renderLines(data) {
      linesData = data;
      var uv = data.uv;
      var pageHeight = document.documentElement.scrollHeight || document.body.scrollTop;
      // 切割成n块
      var blockNum = Math.ceil(pageHeight / 10);
      for (var i = 0; i < blockNum; i++) {
          var value = data.detail[i] ? (data.detail[i] / uv * 100).toFixed(2) : 0;
          var top = i * 10;
          if (top > 500 && i % 20 === 0) {
              createElement('div', {
                  class: 'ark-page-line',
                  content: lineTpl(value),
                  style: {
                      top: top + 'px'
                  }
              });
          }
      }
      document.removeEventListener('mousemove', setMouseLine);
      document.addEventListener('mousemove', setMouseLine);
  }

  // 创建视图
  function createView() {
      createElement('div', {
          id: 'arkHeadmapBody',
          class: 'ark-headmap-body'
      });
      if (window.top === window.self) {
          getUrlArkcontentText();
          nav();
      }
      heatmap$2();
      loading();
      tips();
      render();
  }
  // 渲染深度线数据
  function renderLinesData() {
      getLinesData(function (res) {
          renderLines(res.datas);
      });
  }
  // 渲染热图
  function render() {
      if (!arkcontent) {
          return;
      }
      if (heatConfig.heatMapType === 'lines') {
          renderLinesData();
      } else {
          // 获取热图数据
          getHeatmapData(function (res) {
              if (heatConfig.heatMapType === 'location') {
                  // 渲染热图
                  renderHeatmap(res.datas);
              }
              if (heatConfig.heatMapType === 'element') {
                  renderElement(res.datas);
              }
          });
      }
  }

  const getAttrKeys = function(attrs) {
    let dataAttr = {};
    for (let i = 0; i < attrs.length; i++) {
      let item = attrs[i];
      let temp = {
        key: item.name,
        value: item.value
      };
      dataAttr[temp.key] = temp.value;
    }
    return dataAttr;
  };
  let fixEvent = function(e) {
    if (!e.target) {
      e.target = e.srcElement;
      e.pageX = e.x;
      e.pageY = e.y;
    }
    if (/mouseover/i.test(e.type) && !e.relatedTarget) {
      e.relatedTarget = e.fromElement;
    } else if (/mouseout/i.test(e.type) && !e.relatedTarget) {
      e.relatedTarget = e.toElement;
    }
    return e;
  };
  const eventAgent = (evt, func) => {
    const evt1 = fixEvent(evt);
    const actEl = evt1.currentTarget;
    let el = evt1.target, actionType, isFind, attr;
    while (el && el !== actEl) {
      actionType = el.getAttribute("event-agent") || "";
      actionType = actionType.trim().toLowerCase().split(",");
      if (actionType.indexOf(evt1.type.toLowerCase()) !== -1) {
        attr = getAttrKeys(el.attributes);
        isFind = true;
        break;
      }
      el = el.parentNode;
    }
    isFind && func && func(el, attr);
  };

  // 控制器列表
  var controllerList = {
      // 刷新
      refresh: function () {
          arkcontent.useCache = false;
          render();
          arkcontent.useCache = true;
      },
      // 热图类型切换
      heatmapTab: function (e, attrs) {
          emptySelected();
          var type = attrs['heat-type'];
          heatConfig.heatMapType = type;
          setSelected();
          toolDisplay();
          heatmapDisplay();
          elementDisplay();
          displayLines();
          render();
      },
      // 热图显示
      heatmapSwitch: function () {
          heatConfig.heatMapShow = !heatConfig.heatMapShow;
          heatSwitch();
          heatmapDisplay();
          elementDisplay();
      },
      // 深度线显示与隐藏
      displayDepth: function () {
          displayConfig.lineShow = !displayConfig.lineShow;
          displayDepth();
          displayLines();
          renderLinesData();
      },
      // 展开收起
      navOpen: function () {
          heatConfig.isOpen = !heatConfig.isOpen;
          navOpen();
      }
  };
  function viewController () {
      document.getElementById('arkHeadmapBody').addEventListener('click', function (event) {
          eventAgent(event, function (e, attrs) {
              var controllerName = attrs['controller-name'];
              controllerList[controllerName](e, attrs, event);
          });
      });
  }

  function chartDisplay() {
      heatmapDisplay();
      elementDisplay();
  }
  function iframeMessage () {
      // 给上层窗口发送消息
      window.parent.postMessage(JSON.stringify({
          code: 'ark/heatmap',
          appkey: globalWindow.AnalysysAgent.config.appkey
      }), '*');
      // 监听ifram发送过来的消息
      window.addEventListener('message', function (event) {
          var data = event.data;
          console.log(data);
          var msgTypeMap = {
              'ark/heatmap': 'location',
              'ark/depth': 'lines',
              'ark/element': 'element',
              'ark/attention': '1'
          };
          var type = msgTypeMap[data.code];
          if (type) {
              setArkcontent(data.content);
              heatConfig.heatMapType = type;
              heatConfig.heatMapShow = true;
              var controlType = data.control.type;
              if (data.control.type === 'refresh') {
                  arkcontent.useCache = false;
              }
              // 显示隐藏热图
              if (data.control.type === 'closeHeatMap') {
                  heatConfig.heatMapShow = false;
                  chartDisplay();
              } else if (data.control.type === 'closeDepth' && displayConfig.lineShow) {
                  // 关闭深度线
                  displayConfig.lineShow = false;
                  displayLines();
              } else if (data.control.type === 'openDepth' && !displayConfig.lineShow) {
                  // 打开深度线
                  displayConfig.lineShow = true;
                  displayLines();
                  chartDisplay();
                  renderLinesData();
              } else if (controlType === 'heatmapOpacity') {
                  //热图背景调整
                  displayConfig.backgroundTransparent = data.control.value.opacity;
                  setHeatMapConfig();
              } else if (controlType === 'heatmapcolorRange') {
                  displayConfig.min = data.control.value.min;
                  displayConfig.max = data.control.value.maxValue;
                  setHeatMapConfig();
              } else {
                  chartDisplay();
                  render();
              }
          }
      });
  }

  storeInit();
  document.addEventListener('readystatechange', function () {
      if (document.readyState === 'complete') {
          // 添加热图视图
          createView();
          // 添加视图控制器
          viewController();
          if (window.top !== window.self) {
              iframeMessage();
          }
      }
  });

}());
